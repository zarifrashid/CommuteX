<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}CommuteX{% endblock %}</title>

  <style>
    :root{
      --primary:#0B4B95;
      --bg:#f6f8fc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(900px 500px at 20% -10%, rgba(11,75,149,.16), transparent 60%),
                  radial-gradient(700px 500px at 90% 0%, rgba(11,75,149,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:18px}

    /* Header */
    header{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .nav{display:flex; align-items:center; justify-content:space-between; gap:14px}
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:900; color:var(--primary); text-decoration:none;
      letter-spacing:.2px;
    }
    .brandDot{
      width:10px;height:10px;border-radius:999px;
      background:var(--primary);
      box-shadow:0 0 0 6px rgba(11,75,149,.14);
    }
    .navLinks{display:flex; align-items:center; gap:12px}
    .navLinks a{
      text-decoration:none;
      color:var(--primary);
      font-weight:700;
      padding:8px 10px;
      border-radius:10px;
    }
    .navLinks a:hover{background:rgba(11,75,149,.08)}

    /* Card */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px;
      box-shadow: var(--shadow);
    }

    /* Messages */
    .msg{
      background:#fff;
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:12px;
      margin:12px 0;
    }

    /* Buttons */
    .btn{
      border:1px solid var(--border);
      background:#fff;
      color:var(--primary);
      font-weight:800;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
    }
    .btnPrimary{
      background:var(--primary);
      color:#fff;
      border:none;
    }
    .btn:hover{opacity:.96; transform: translateY(-1px); transition:.15s}
    .btn:active{transform: translateY(0)}

    /* Profile dropdown */
    .profileWrap{position:relative}
    .profileBtn{
      display:flex; align-items:center; gap:10px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:6px 10px 6px 6px;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    .avatar{
      width:34px;height:34px;border-radius:999px;
      display:grid;place-items:center;
      background:rgba(11,75,149,.12);
      color:var(--primary);
      font-weight:900;
    }
    .pMeta{line-height:1.05; text-align:left}
    .pName{font-weight:900; font-size:13px; max-width:140px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .pSub{font-size:12px; color:var(--muted)}

    .menu{
      position:absolute; right:0; top:46px;
      width:220px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow: var(--shadow);
      padding:8px;
      display:none;
    }
    .menu a, .menu button{
      width:100%;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      text-decoration:none;
      color:var(--text);
      font-weight:700;
      padding:10px 10px;
      border-radius:12px;
      border:none;
      background:transparent;
      cursor:pointer;
    }
    .menu a:hover, .menu button:hover{background:rgba(11,75,149,.08)}
    .menu small{color:var(--muted); font-weight:600}
    .menu.show{display:block}

    footer{color:var(--muted); font-size:14px; padding:30px 0}
  </style>
</head>

<body>

<header>
  <div class="wrap nav">
    <a class="brand" href="{% url 'landing' %}">
      <span class="brandDot"></span>
      CommuteX
    </a>

    <div class="navLinks">
      <a href="{% url 'landing' %}">Home</a>

      {% if user.is_authenticated %}
        <div class="profileWrap">
          <button class="profileBtn" id="profileBtn" type="button">
            <div class="avatar">
              {% if user.username %}{{ user.username|slice:":1"|upper }}{% else %}U{% endif %}
            </div>
            <div class="pMeta">
              <div class="pName">
                {% if user.get_full_name %}{{ user.get_full_name|default:user.username }}{% else %}{{ user.username|default:"User" }}{% endif %}
              </div>
              <div class="pSub">Account</div>
            </div>
            <small>▾</small>
          </button>

          <div class="menu" id="profileMenu">
            <a href="{% url 'profile' %}">
              Profile <small>View info</small>
            </a>

            <form method="post" action="{% url 'logout' %}" style="margin:0;">
              {% csrf_token %}
              <button type="submit">
                Logout <small>Sign out</small>
              </button>
            </form>
          </div>
        </div>
      {% else %}
        <a href="{% url 'login' %}">Login</a>
        <a href="{% url 'signup' %}">Sign up</a>
      {% endif %}
    </div>
  </div>
</header>

<main class="wrap">
  {% if messages %}
    {% for message in messages %}
      <div class="msg">{{ message }}</div>
    {% endfor %}
  {% endif %}

  {% block content %}{% endblock %}
</main>

<footer class="wrap">
  © {% now "Y" %} CommuteX
</footer>

<script>
  (function () {
    const btn = document.getElementById("profileBtn");
    const menu = document.getElementById("profileMenu");
    if (!btn || !menu) return;

    btn.addEventListener("click", () => menu.classList.toggle("show"));

    document.addEventListener("click", (e) => {
      if (!menu.classList.contains("show")) return;
      const inside = btn.contains(e.target) || menu.contains(e.target);
      if (!inside) menu.classList.remove("show");
    });
  })();
</script>

</body>
</html>